<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coupons</title>
<style>
  .coupon {
    display: inline-block;
    position: relative;
    width: 200px;
    height: 100px;
    margin: 15px;
    background: linear-gradient(90deg, #ffcc00 0%, #ff9900 100%);
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
    cursor: pointer;
    user-select: none;
    outline: none;
    transition: background-color 0.3s;
    color: #222;
    padding: 12px;
  }
  .coupon.used {
    background: #888888;
    cursor: default;
    color: #eee;
  }
  .coupon:focus {
    box-shadow: 0 0 0 3px #3399ff;
  }
  .tear-label {
    position: absolute;
    top: 8px;
    right: 12px;
    font-weight: bold;
    font-size: 1.2rem;
    user-select: none;
  }
  .coupon.used .tear-label {
    color: #eee;
  }
  h3 {
    margin: 0 0 8px 0;
  }
  p {
    margin: 0;
  }
</style>
</head>
<body>

  <div class="coupon" data-id="coupon1" role="button" tabindex="0" aria-pressed="false" aria-label="Coupon 1, unused">
    <div class="tear-label"><span>USE</span></div>
    <h3>10% OFF</h3>
    <p>Use this coupon to get 10% off your next purchase.</p>
  </div>

  <div class="coupon" data-id="coupon2" role="button" tabindex="0" aria-pressed="false" aria-label="Coupon 2, unused">
    <div class="tear-label"><span>USE</span></div>
    <h3>Free Shipping</h3>
    <p>Apply this coupon for free shipping on your order.</p>
  </div>

  <div class="coupon" data-id="coupon3" role="button" tabindex="0" aria-pressed="false" aria-label="Coupon 3, unused">
    <div class="tear-label"><span>USE</span></div>
    <h3>15% OFF</h3>
    <p>Save 15% on orders over $50.</p>
  </div>

<script>
  // Try to load used coupons from localStorage or initialize empty object
  let usedCoupons = {};
  try {
    const stored = localStorage.getItem('usedCoupons');
    if (stored) {
      usedCoupons = JSON.parse(stored);
    }
  } catch (err) {
    console.error('Could not parse usedCoupons from localStorage:', err);
  }

  function markCouponUsed(coupon) {
    coupon.classList.add('used');
    coupon.setAttribute('aria-pressed', 'true');
    // Update aria-label to reflect used status
    const oldLabel = coupon.getAttribute('aria-label') || '';
    coupon.setAttribute('aria-label', oldLabel.replace('unused', 'used'));
    // Update label text to USED
    const label = coupon.querySelector('.tear-label span');
    if (label) label.textContent = 'USED';
    // Remove pointer cursor
    coupon.style.cursor = 'default';
  }

  // Attach handlers and initialize used coupons state
  document.querySelectorAll('.coupon').forEach(coupon => {
    const id = coupon.getAttribute('data-id');

    // Mark used on page load if stored
    if (usedCoupons[id]) {
      markCouponUsed(coupon);
    }

    coupon.addEventListener('click', () => {
      if (!coupon.classList.contains('used')) {
        markCouponUsed(coupon);
        usedCoupons[id] = true;
        try {
          localStorage.setItem('usedCoupons', JSON.stringify(usedCoupons));
        } catch (err) {
          console.error('Failed to save usedCoupons:', err);
        }
      }
    });

    // Keyboard accessibility (Enter or Space)
    coupon.addEventListener('keydown', e => {
      if ((e.key === 'Enter' || e.key === ' ') && !coupon.classList.contains('used')) {
        e.preventDefault();
        coupon.click();
      }
    });
  });
</script>

</body>
</html>

